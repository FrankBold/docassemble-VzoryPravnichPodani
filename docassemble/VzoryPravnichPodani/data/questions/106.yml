metadata:
  title: Žádost o poskytnutí informací
  short title: zadost_o_informace
  description: Průvodce přípravou a podáním žádosti o informace.
  authors:
    - name: Michal Kuk
      organization: Frank Bold Society
  revision_date: 2020-10-29
---
features:
  question help button: True
---
modules:
  - .integrace
  - .overovac
  - .utility
---
objects:
  - Podatel: Person.using(nazev="podatele")
  - Adresat: Organization
  - Podani: Thing
  - Komentar: DAFileCollection
---
mandatory: True
code: |
  nabidkaFBA = True
  nazev = "Žádost o informace"
  if 'zdroj' in url_args:
    zdroj = url_args['zdroj']
---
include:
  - t_mail.yml
  - objektPerson.yml
  - final_screen.yml
---
# Otázky
# Úřad, který příkaz vydal
ga id: povinnySubjekt
question: |
  Od koho informace požadujete.
subquestion: |
  K poskytnutí informací podle zákona o svobodném přístupu k informací jsou povinny pouze tak uvedené povinné subjekty. Pokud si nejste jisti, zda ten po kom informace chcete je povinnen je poskytnout, podívejte se do naší [nápovědy](${ url_of('help') }).
fields:
  - Způsob zadání: rucne
    input type: radio
    choices:
        - Vyplním ručně: True
        - Dle ID datové schránky: False
  - ID datové schránky: Adresat.idds
    show if:
      variable: rucne
      is: False
help:
  label: Kdo je povinný orgán?
  content: |
      V souladu s § 2 informačního zákona jsou

      * státní orgány,
      * územní samosprávné celky a jejich orgány a
      * veřejné instituce a dále
      * subjekty, kterým zákon svěřil rozhodování o právech, právem chráněných zájmech nebo povinnostech fyzických nebo právnických osob v oblasti veřejné správy v rozsahu této jejich rozhodovací činnosti (pro zjednodušení dále jen „úřad“)

      povinny poskytovat podle tohoto zákona informace vztahující se k jejich působnosti, a to na základě ústní nebo písemné žádosti fyzických a právnických osob.
---
ga id: adresatRucne
if: |
  rucne
question: |
  Identifikační údaje orgánu
subquestion: |
  % if defined('hlaska'):
  <div class="alert alert-warning">
  Bohužel se nepodařilo údaje doplnit automaticky. Zadejte je prosím ručně.
  </div>
  % endif
fields:
  - Název orgánu: Adresat.name.text
  - Oddělení: Adresat.oddeleni
    required: False
  - Ulice a čp: Adresat.ulice
  - Obec: Adresat.obec
  - PSČ: Adresat.psc
  - ID DS: Adresat.idds
    show if:
      code: |
        Podani.forma == 'datovka'
---
# Získání údajů o kraji
if: |
  rucne == False
code: |
  vystup_urad = uradDleDatovky(Adresat.idds)
  if vystup_urad == "chyba":
    rucne = True
    hlaska = True
    Adresat.name.text
  else:
    Adresat.name.text = vystup_urad['NazevOsoby']
    Adresat.ulice = vystup_urad['AdresaSidla']['UliceNazev'] +" "+ vystup_urad['AdresaSidla']['CisloDomovni'] +"/"+ vystup_urad['AdresaSidla']['CisloOrientacni']
    Adresat.psc = vystup_urad['AdresaSidla']['PostaKod']
    Adresat.obec = vystup_urad['AdresaSidla']['ObecNazev']
    Adresat.idds = vystup_urad['ISDS']
---
# Předmět podnětu
ga id:  smlouva
question: |
  Předmět žádosti o informace
subquestion: |
  O jakou smlouvu Vám jde
fields:
  - Číslo smlouvy: Podani.smlouvaCislo
  - Datum uzavření smlouvy: Podani.smlouvaDatum
    datatype: date
---
# Způsob obdržení
ga id: zpusobObdrzeni
question: |
  Jak chcete obdržet odpověď?
fields:
  - Odpověď chci: Podani.odpoved
    input type: radio
    choices:
      na e-mail: email
      poštou: posta
      do datové schránky: datovka
  - Váš e-mail: Podatel.email
    datatype: email
    show if:
      variable: Podani.odpoved
      is: email
  - ID datové schránky: Podatel.idds
    show if:
      variable: Podani.odpoved
      is: datovka
---
# Způsob odeslání
ga id: zpusobOdeslani
question: |
  Odeslání podnětu
fields:
  - Jak budete podnět odesílat?: Podani.forma
    input type: radio
    choices:
      - Poštou: posta
      - Datovou schránkou: datovka
      - E-mailem: email
  - Chcete přikládat přílohy: Podani.prilohy
    datatype: yesnoradio
  - Seznam příloh: prilohy
    datatype: area
    hint: |
      Jednotlivé položky oddělte "enterem".
    show if:
      variable: Podani.prilohy
      is: true
---
# Rozdělení příloh na seznam
code: |
  Podani.prilohySeznam = string_pole(prilohy)
---
# Odeslání souborů
need: vzor
id: souboryKeStazeni
progress: 100
question: |
  Vaš vzor je připraven
subquestion: |
  Vzor Vám společné s manuálem pošleme na e-mail.
  *E-mail nepřihlašujeme automaticky k žádnému newsletteru.*

  % if user_has_privilege('admin'):
  [Stáhnout](${ vzor.url_for() })
  % endif
fields:
  - Váš e-mail: email
    datatype: email
    default: |
      % if defined('Podatel.email'):
      ${ Podatel.email }
      % endif
  - Přihlásit k odběru novinek: novinky
    datatype: yesno
---
# Odeslání e-mailu se vzorem. Zároveň přidání kontaktu k mailing listu v rámci Ecomailu.
event: odeslatEmail
sets: vseHotovo
code: |
  vzor
  emailOdeslan = send_email(email, template=t_vzor, attachments=[vzor,DAStaticFile(filename='Zadost_o_informace_Komentar.pdf')])
  if novinky:
    ecomail = addEcomail(email, "12", "Zadost o informace")
  if emailOdeslan:
    vseHotovo = True
    webhook_data = requests.post('https://hook.integromat.com/ekpnq1umeahy5pl2baq6czmplr7lfbvt', data=json.dumps(all_variables()),headers={'Content-Type': 'application/json'})
  else:
    neodeslano
---
attachment:
  name: Žádost o informace
  filename: Zadost o informace
  variable name: vzor
  docx template file: 106.docx
  valid formats:
    - docx
